<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>科技处</title>
    <!-- <link rel="stylesheet" href="css/index.css"> -->
    <!-- <script src="/kjcManager/ws/cugb/js/jquery-1.12.4.min.js"></script> -->
    <link rel="stylesheet" href="/kjcManager/ws/cugb/css/swiper.min.css">
    <link rel="stylesheet" href="/kjcManager/ws/cugb/css/idangerous.swiper.css">
    <link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/css/hometop.css">
    <link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/css/indexmb1.css">
    <link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/css/list.css">
    <!-- 引入样式 -->
    <link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/lib-master/theme-chalk/index.css" />
    <script src="/kjcManager/ws/cugb/js/jquery-3.1.0.min.js"></script>
    <script src="/kjcManager/ws/cugb/js/idangerous.swiper.min.js"></script>
    <script src="/kjcManager/ws/cugb/js/scrollReveal.js" async></script>
    <script src="/kjcManager/ws/cugb/js/anime.min.js" async></script>
    <script src="/kjcManager/ws/cugb/js/paging.js"></script>
    <!-- 引入amchart核心文件 -->
    <script src="/kjcManager/ws/cugb/js/core.js"></script>
    <script src="/kjcManager/ws/cugb/js/charts.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/animated.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/material.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/dataviz.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/amchartsdark.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/dark.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/frozen.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/kelly.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/moonrisekingdom.js"></script>
    <script src="/kjcManager/ws/cugb/js/themes/patterns.js"></script>
    <script>
        function loadJS(url, callback) {
            var script = document.createElement('script');
            var fn = callback || function () { };
            script.type = 'text/javascript';

            if (script.readyState) { //IE
                script.onreadystatechange = function () {
                    if (script.readyState == 'loaded' || script.readyState == 'complete') {
                        script.onreadystatechange = null;
                        fn();
                    }
                };

            } else { //其他浏览器
                script.onload = function () {
                    fn();
                };
            }

            script.src = url;
            document.getElementsByTagName('head')[0].appendChild(script);
        }
        function deviceProbing() {
            var reg = /([a-zA-Z]+)?([a-zA-Z]+.*\;\s([a-zA-Z0-9]+)?)/
            var newNav = navigator.appVersion.match(reg);
            if (newNav) {
                var nav = newNav[0];
                var navArr = nav.split(/(\s)|((\s\d\.\d)?\;)/);
                var flag = false;
                for (var i = 0, len = navArr.length; i < len; i++) {
                    if (navArr[i] == 'Android' || navArr[i] == 'iPhone' || navArr[i] == 'iPad' || navArr[i] == 'MeeGo' || navArr[i] == 'NokiaN9' || navArr[i] == 'NOKIA') {
                        flag = true;
                        break;
                    } else {
                        flag = false;
                    }
                }
                return flag;
            }
        }
        function getFontSize() {
            var deviceWidth = document.documentElement.clientWidth;
            document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
            window.onresize = function () {
                var deviceWidth = document.documentElement.clientWidth;
                document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
            };
        }
        function IEVersion() {
            //取得浏览器的userAgent字符串
            var userAgent = navigator.userAgent;
            //判断是否IE浏览器
            var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1;
            if (isIE) {
                var reIE = new RegExp("MSIE (\\d+\\.\\d+);");
                reIE.test(userAgent);
                var fIEVersion = parseFloat(RegExp["$1"]);
                if (fIEVersion < 10) {
                    return true;
                }
            } else {
                return false;
            }
        }
        var page_border_height = '3px';
        if (deviceProbing()) {
            page_border_height = '0.03rem';
            getFontSize();
            document.write('<link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/css/mobile.css">');
            document.write('<link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/css/mobilelist.css">');
            loadJS('/kjcManager/ws/cugb/js/mobilepclist.js');
        } else {
            $('html').css('font-size', '');
            document.write('<link rel="stylesheet" type="text/css" href="/kjcManager/ws/cugb/css/pcmedia.css">');
            if (IEVersion()) {
                // document.write('<link rel="stylesheet" type="text/css" href="/kjc/css/pcIe.css">');
                loadJS('/kjcManager/ws/cugb/js/pclist.js');
            } else {
                loadJS('/kjcManager/ws/cugb/js/pclist.js');
            }
        }
    </script>

</head>

<body>
    <!-- header logo -->
    <div class="home_headerbox">
        <div class="home_nav" id='homehead'>
            <a href="https://cms.cugb.edu.cn/kjc/">
                <div class="hn_logo"><img src='https://bm.cugb.edu.cn/kjc/images/kjc.png' /></div>
            </a>
        </div>
    </div>

    <div class="home_pagemainbox">
        <!-- 轮播背景图区域 -->
        <div class="home_banner home_listbanner">
            <div class="container">
                <div class="timeline">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide"
                                style="background: url('https://bm.cugb.edu.cn/kjc/images/01.png') no-repeat top center/100% auto;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="list_banner_botbox">
                <div class="list_title">学术论文</div>
                <div class="list_back"><a href="javascript:void(0)" onclick="history.go(-1);">
                        <img src="https://bm.cugb.edu.cn/kjc/images/list/jiantou_icon.png" />
                        <label>返回</label>
                    </a>
                </div>
            </div>
        </div>
        <!-- 内容详情区 -->
        <div id="app">
            <div class="detail_box" id='list_detail_box'>
                    <div class="detail_title_box" style="height: 120px;">
                        <div class="detail_title">{{year}}年{{department[deptCode]}}{{type[typeCode]}}</div>
                        <!-- pc端 时间 次数 -->
                        <!-- <div class="detail_info"><label>发布时间：2021-06-17</label><label>阅读：<span id="hitcount691753">0</span>
                        
                        次
                    </label></div> -->
                        <!-- 移动端 时间 次数 发布人-->
                        <div class="m_detail_info">
                            <div>
                                <label>[信息网络中心]魏玮</label>
                                <label>06月17日</label>
                            </div>
                            <div>
                            </div>
                        </div>

                    </div>
                    <div class="detail_content_box">
                        <div>
                            <el-table border size="medium" :data="tableData" style="width: 100%">
                                <el-table-column prop="id" align="center" width="60" label="序号">
                                </el-table-column>
                                <el-table-column prop="info" align="left" label="论文信息">
                                </el-table-column>
                            </el-table>
                            <!-- 分页 -->
                            <div class="pagination" style="float: right;">
                                <el-pagination background @size-change="handleSizeChange"
                                    @current-change="handleCurrentChange" :page-sizes="[10, 20, 30, 40]"
                                    :current-page="curPage" :page-size="pageSize"
                                    layout="total, sizes, prev, pager, next" :total="total">
                                </el-pagination>
                            </div>
                        </div>
                    </div>
            </div>
        </div>

        <!-- 底部 PC -->
        <div class="home_bottom">
            <div class="home_bot_box">
                <div class="home_bot_link home_bot_banquan">
                    <div class="home_bot_linktitle">版权信息</div>
                    <ul class="home_bot_banquanbox">
                        <li>版权所有:中国地质大学(北京)</li>
                        <li>地址:北京市海淀区学院路29号</li>
                        <li>邮编:100083</li>
                        <li>文保网安备案:1101080023</li>
                        <li>技术支持:信息网络中心</li>
                    </ul>
                </div>

                <div class="home_bot_link home_bot_gongzhong">
                    <div class="home_bot_gongzhong_text">
                        <div class="home_bot_linktitle">公众号 </div>
                        <ul class="home_bot_linkbox">
                            <li>扫码关注公众号</li>
                            <li>浏览最新文章信息</li>
                        </ul>
                    </div>
                    <div class="home_bot_gongzhong_img">

                        <img src="https://bm.cugb.edu.cn/kjc/upload/resources/image/2021/06/17/130830.png" />

                    </div>
                </div>

                <div class="home_bot_link m_home_bot_banquanlianxi">
                    <div class="home_bot_linktitle">联系我们</div>
                    <ul class="home_bot_banquanbox">
                        <li>地址:北京市海淀区学院路29号</li>
                        <li>邮编:100083</li>
                        <li>技术支持:信息网络中心</li>
                    </ul>
                    <div class="home_bot_gongzhong_img">

                        <img src="https://bm.cugb.edu.cn/kjc/upload/resources/image/2021/06/17/130830.png" />

                    </div>
                </div>
                <div class="home_bot_link m_home_bot_banquanotherbox">
                    <ul class="m_home_bot_banquanother">
                        <li>© 版权所有:中国地质大学(北京)</li>
                        <li>文保网安备案:1101080023</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- 底部结束 -->
    </div>
<script src="/kjcManager/ws/cugb/js/echarts.js"></script>
<!-- import Vue before Element -->
<script src="/kjcManager/ws/cugb/js/vue.js"></script>
<!-- import JavaScript -->
<script src="/kjcManager/ws/cugb/lib-master/index.js" type="text/javascript" charset="utf-8"></script>
<!-- import axios cdn -->
<script src="/kjcManager/ws/cugb/js/axios.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->

<script>
    new Vue({
        el: '#app',
        data: function () {
            return {
                year: '',//论文年限
                deptCode: '',//学院id
                typeCode: '',
                tableData: [],
                json: {},
                curPage: 1,
                pageSize: 10,
                total: 0,
                department: {
                    30100: '地球科学与资源学院',
                    30300: '材料科学与工程学院',
                    30600: '能源学院',
                    30500: '水资源与环境学院',
                    30200: '工程技术学院',
                    31000: '地球物理与信息技术学院',
                    30700: '经济管理学院',
                    31200: '土地科学技术学院',
                    31100: '海洋学院',
                    31900: '数理学院',
                    30400: '信息工程学院',
                    50100: '科研院',
                    30900: '珠宝学院',
                    31800: '马克思主义学院',
                    31600: '继教学院',
                    30000: '教学单位',
                    30800: '外国语学院'
                },
                type: {
                    2: '榜刊论文',
                    'null': '全部论文',
                }
            }
        },
        created() {
            let url = window.location.href
            // var url = 'http://39.103.222.205:8080/kjcManager/kjcQuery.do?curPage=1&deptCode=30100&paperTypeCode=2&paperYear=2013';
            if (url) {
                this.getParams(url)
            }
        },
        mounted() {
            this.getPaperList()
        },
        watch: {

        },
        methods: {
            //改变每页显示条数
            handleSizeChange(val) {
                this.pageSize = val;
                this.curPage = 1;
                this.json.curPage = this.curPage
                this.json.perPage = this.pageSize
                this.getPaperList()
            },
            //改变当前页码
            handleCurrentChange(val) {
                this.curPage = val
                this.json.curPage = this.curPage
                this.getPaperList()
            },
            //获取参数且进行处理
            getParams(url) {
                var json = {};
                url = url.replace(/.*\?/, '');
                var arr = url.split('&');
                let year = arr[1].split('=')
                let dCode = arr[0].split('=')
                this.year = year[1]
                this.deptCode = dCode[1]
                var temp;
                for (var i = 0; i < arr.length; i++) {
                    temp = arr[i].split('=');
                    json[temp[0]] = temp[1];
                };
                json.curPage = 1
                json.perPage = 10
                if (!json.hasOwnProperty("typeCode")) {
                	json.typeCode = 'null'
                	this.typeCode = 'null'
                }else{
                    let tCode = arr[2].split('=')
                	json.typeCode = tCode[1]
                    this.typeCode = tCode[1]
                }
                json.flagCode = 'paper'
				//console.log(json)
                this.json = json
            },
            // 查询列表数据
            getPaperList() {
            	let url = 'http://39.103.222.205:8080/kjcManager/kjcQuery.do'
                // let url = 'http://localhost:8080/kjcManager/kjcQuery.do'
                this.post(url, this.json)
            },
            post(url, param) {
                const ajax = axios.create({
                    timeout: 30000,
                    // baseURL: process.env.api_url, // api的base_url
                    withCredentials: false,
                });
                // ajax.interceptors.response.use(response => {
                //     return response.data;
                // })
                return new Promise((resolve, reject) => {
                    ajax({
                        method: "post",
                        url,
                        data: param,
                        headers: { "Content-Type": "application/json", 'Access-Control-Allow-Origin': '*' },
                    }).then(res => {
                        resolve(res);
                        this.tableData = res.data.kjcQuery
                        this.total = Number(res.data.total)
                    });
                });
            },

        }
    });
</script>
</body>
</html>